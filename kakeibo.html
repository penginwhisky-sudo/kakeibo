  <!DOCTYPE html>
  <html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>家計簿アプリ</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;

      // Lucide Icons (simplified SVG components)
      const Trash2 = ({ size = 24, className = "", style = {} }) => (
        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} style={style}>
          <polyline points="3 6 5 6 21 6"></polyline>
          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          <line x1="10" y1="11" x2="10" y2="17"></line>
          <line x1="14" y1="11" x2="14" y2="17"></line>
        </svg>
      );

      const DollarSign = ({ size = 24, className = "", style = {} }) => (
        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} style={style}>
          <line x1="12" y1="1" x2="12" y2="23"></line>
          <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
        </svg>
      );

      const TrendingDown = ({ size = 24, className = "", style = {} }) => (
        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} style={style}>
          <polyline points="23 18 13.5 8.5 8.5 13.5 1 6"></polyline>
          <polyline points="17 18 23 18 23 12"></polyline>
        </svg>
      );

      const Home = ({ size = 24, className = "", style = {} }) => (
        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} style={style}>
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
          <polyline points="9 22 9 12 15 12 15 22"></polyline>
        </svg>
      );

      const Calendar = ({ size = 24, className = "", style = {} }) => (
        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} style={style}>
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
      );

      const ChevronLeft = ({ size = 24, className = "", style = {} }) => (
        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} style={style}>
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      );

      const ChevronRight = ({ size = 24, className = "", style = {} }) => (
        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} style={style}>
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      );

      const Utensils = ({ size = 24, className = "", style = {} }) => (
        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} style={style}>
          <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"></path>
          <path d="M7 2v20"></path>
          <path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"></path>
        </svg>
      );

      const Droplet = ({ size = 24, className = "", style = {} }) => (
        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} style={style}>
          <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path>
        </svg>
      );

      const ShoppingBag = ({ size = 24, className = "", style = {} }) => (
        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} style={style}>
          <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <path d="M16 10a4 4 0 0 1-8 0"></path>
        </svg>
      );

      const Wine = ({ size = 24, className = "", style = {} }) => (
        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} style={style}>
          <path d="M8 22h8"></path>
          <path d="M12 11v11"></path>
          <path d="M12 11a6 6 0 0 0 6-6V2H6v3a6 6 0 0 0 6 6Z"></path>
        </svg>
      );

      const CreditCard = ({ size = 24, className = "", style = {} }) => (
        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} style={style}>
          <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
          <line x1="1" y1="10" x2="23" y2="10"></line>
        </svg>
      );

      const MoreHorizontal = ({ size = 24, className = "", style = {} }) => (
        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} style={style}>
          <circle cx="12" cy="12" r="1"></circle>
          <circle cx="19" cy="12" r="1"></circle>
          <circle cx="5" cy="12" r="1"></circle>
        </svg>
      );

      const BudgetApp = () => {
        const [dailyBudget, setDailyBudget] = useState(1500);
        const [expenses, setExpenses] = useState([]);
        const [newExpense, setNewExpense] = useState({ category: '', amount: '', date: new Date().toISOString().split('T')[0] });
        const [currentView, setCurrentView] = useState('home');
        const [currentDate, setCurrentDate] = useState(new Date());
        const [isSpinning, setIsSpinning] = useState(false);
        const [gachaResult, setGachaResult] = useState(null);

        // ローカルストレージからデータを読み込む
        useEffect(() => {
          const savedBudget = localStorage.getItem('dailyBudget');
          const savedExpenses = localStorage.getItem('expenses');
          
          if (savedBudget) {
            setDailyBudget(parseFloat(savedBudget));
          }
          
          if (savedExpenses) {
            try {
              const parsed = JSON.parse(savedExpenses);
              setExpenses(parsed);
            } catch (e) {
              console.error('データの読み込みに失敗しました', e);
            }
          }
        }, []);

        // 予算が変更されたらローカルストレージに保存
        useEffect(() => {
          localStorage.setItem('dailyBudget', dailyBudget.toString());
        }, [dailyBudget]);

        // 支出が変更されたらローカルストレージに保存
        useEffect(() => {
          localStorage.setItem('expenses', JSON.stringify(expenses));
        }, [expenses]);

        const categories = [
          { name: '食費', icon: Utensils, color: '#1D9BF0' },
          { name: '日用品', icon: Droplet, color: '#1D9BF0' },
          { name: '衣服', icon: ShoppingBag, color: '#1D9BF0' },
          { name: '交際費', icon: Wine, color: '#1D9BF0' },
          { name: '固定費', icon: CreditCard, color: '#1D9BF0' },
          { name: 'その他', icon: MoreHorizontal, color: '#1D9BF0' },
        ];

        const today = new Date().toLocaleDateString('ja-JP', {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });

        const totalExpenses = expenses.reduce((sum, expense) => sum + expense.amount, 0);
        const remaining = dailyBudget - totalExpenses;
        const isOverBudget = remaining < 0;

        const addExpense = () => {
          if (newExpense.category && newExpense.amount && newExpense.date) {
            const selectedDate = new Date(newExpense.date);
            setExpenses([...expenses, {
              id: Date.now(),
              category: newExpense.category,
              amount: parseFloat(newExpense.amount),
              timestamp: new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' }),
              date: selectedDate.toLocaleDateString('ja-JP'),
              dateObj: selectedDate
            }]);
            setNewExpense({ category: '', amount: '', date: new Date().toISOString().split('T')[0] });
          }
        };

        const deleteExpense = (id) => {
          setExpenses(expenses.filter(expense => expense.id !== id));
        };

        const handleCategorySelect = (categoryName) => {
          setNewExpense({ ...newExpense, category: categoryName });
        };

        const spinGacha = () => {
          if (isSpinning) return;
          
          setIsSpinning(true);
          setGachaResult(null);
          
          const random = Math.random() * 100;
          let result;
          
          if (random < 50) {
            result = 100;
          } else if (random < 80) {
            result = 500;
          } else if (random < 95) {
            result = 1000;
          } else {
            result = 3000;
          }
          
          setTimeout(() => {
            setGachaResult(result);
            setDailyBudget(prev => prev + result);
            setIsSpinning(false);
          }, 2000);
        };

        const getDaysInMonth = (date) => {
          const year = date.getFullYear();
          const month = date.getMonth();
          const firstDay = new Date(year, month, 1);
          const lastDay = new Date(year, month + 1, 0);
          const daysInMonth = lastDay.getDate();
          const startDayOfWeek = firstDay.getDay();
          
          return { daysInMonth, startDayOfWeek, year, month };
        };

        const getExpensesForDate = (year, month, day) => {
          const dateStr = new Date(year, month, day).toLocaleDateString('ja-JP');
          return expenses.filter(exp => exp.date === dateStr);
        };

        const getTotalForDate = (year, month, day) => {
          const dayExpenses = getExpensesForDate(year, month, day);
          return dayExpenses.reduce((sum, exp) => sum + exp.amount, 0);
        };

        const getCellColor = (total) => {
          if (total === 0) return 'bg-white';
          if (total <= dailyBudget) return 'bg-blue-100';
          if (total <= dailyBudget + 500) return 'bg-green-100';
          return 'bg-red-100';
        };

        const getTextColor = (total) => {
          if (total === 0) return 'text-gray-700';
          if (total <= dailyBudget) return 'text-blue-700';
          if (total <= dailyBudget + 500) return 'text-green-700';
          return 'text-red-700';
        };

        const changeMonth = (direction) => {
          const newDate = new Date(currentDate);
          newDate.setMonth(newDate.getMonth() + direction);
          setCurrentDate(newDate);
        };

        const renderCalendar = () => {
          const { daysInMonth, startDayOfWeek, year, month } = getDaysInMonth(currentDate);
          const days = [];
          const weekDays = ['日', '月', '火', '水', '木', '金', '土'];

          const headers = weekDays.map((day, i) => (
            <div key={`header-${i}`} className={`text-center font-bold text-sm py-2 ${i === 0 ? 'text-red-500' : i === 6 ? 'text-blue-500' : 'text-gray-700'}`}>
              {day}
            </div>
          ));

          for (let i = 0; i < startDayOfWeek; i++) {
            days.push(<div key={`empty-${i}`} className="p-2"></div>);
          }

          for (let day = 1; day <= daysInMonth; day++) {
            const total = getTotalForDate(year, month, day);
            const cellColor = getCellColor(total);
            const textColor = getTextColor(total);
            
            days.push(
              <div key={day} className={`p-2 border border-gray-200 min-h-20 ${cellColor}`}>
                <div className={`text-sm font-bold mb-1 ${textColor}`}>
                  {day}
                </div>
                {total > 0 && (
                  <div className={`text-xs font-bold ${textColor}`}>
                    ¥{total.toLocaleString()}
                  </div>
                )}
              </div>
            );
          }

          return (
            <div>
              <div className="grid grid-cols-7 gap-0">
                {headers}
              </div>
              <div className="grid grid-cols-7 gap-0">
                {days}
              </div>
            </div>
          );
        };

        return (
          <div className="min-h-screen bg-gray-50">
            <div className="max-w-xl mx-auto bg-white min-h-screen pb-20">
              <div className="sticky top-0 bg-white border-b border-gray-100 z-10">
                <div className="flex items-center justify-between p-3">
                  {currentView === 'home' ? (
                    <input
                      type="date"
                      value={newExpense.date}
                      onChange={(e) => setNewExpense({ ...newExpense, date: e.target.value })}
                      className="flex-1 px-3 py-2 text-base border border-gray-200 rounded-lg focus:outline-none bg-white font-bold"
                      style={{borderColor: '#E8E8E8'}}
                      onFocus={(e) => e.currentTarget.style.borderColor = '#1D9BF0'}
                      onBlur={(e) => e.currentTarget.style.borderColor = '#E8E8E8'}
                    />
                  ) : (
                    <div className="flex items-center gap-2">
                      <div className="w-8 h-8 rounded-full flex items-center justify-center" style={{backgroundColor: '#1D9BF0'}}>
                        <Calendar size={18} className="text-white" />
                      </div>
                      <h1 className="text-base font-bold text-gray-900">履歴</h1>
                    </div>
                  )}
                </div>
              </div>

              {currentView === 'home' ? (
                <>
                  <div className="border-b-2 border-gray-100 p-2 bg-white">
                    <div>
                      <h2 className="text-sm font-bold text-gray-900 mb-2">カテゴリー</h2>
                      <div className="grid grid-cols-3 gap-2">
                        {categories.map((cat) => {
                          const Icon = cat.icon;
                          const isSelected = newExpense.category === cat.name;
                          return (
                            <button
                              key={cat.name}
                              onClick={() => handleCategorySelect(cat.name)}
                              className={`p-2 rounded-lg border-2 transition flex flex-col items-center justify-center gap-1 ${
                                isSelected ? 'border-opacity-100' : 'border-gray-200'
                              }`}
                              style={{
                                borderColor: isSelected ? cat.color : undefined,
                                backgroundColor: isSelected ? `${cat.color}15` : 'white'
                              }}
                            >
                              <Icon size={20} style={{ color: cat.color }} />
                              <span className="text-xs font-bold text-gray-900">{cat.name}</span>
                            </button>
                          );
                        })}
                      </div>
                    </div>
                  </div>

                  <div className="border-b-2 border-gray-100 p-3 bg-white">
                    <input
                      type="number"
                      placeholder="金額を入力"
                      value={newExpense.amount}
                      onChange={(e) => setNewExpense({ ...newExpense, amount: e.target.value })}
                      className="w-full px-3 py-2 text-lg border border-gray-200 rounded-lg focus:outline-none bg-white mb-3"
                      style={{borderColor: '#E8E8E8'}}
                      onFocus={(e) => e.currentTarget.style.borderColor = '#1D9BF0'}
                      onBlur={(e) => e.currentTarget.style.borderColor = '#E8E8E8'}
                    />
                    
                    <button
                      onClick={addExpense}
                      className="w-full text-white px-6 py-3 rounded-lg font-bold transition text-base"
                      style={{backgroundColor: '#1D9BF0'}}
                      onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#1A8CD8'}
                      onMouseLeave={(e) => e.currentTarget.style.backgroundColor = '#1D9BF0'}
                    >
                      追加する
                    </button>
                  </div>

                  <div className="border-b-2 border-gray-100 p-2 bg-white">
                    <div className="flex items-end gap-2 mb-1">
                      <div className="flex-1">
                        <label className="text-xs text-gray-500 mb-1 block">今日の予算</label>
                        <input
                          type="number"
                          value={dailyBudget}
                          onChange={(e) => setDailyBudget(parseFloat(e.target.value) || 0)}
                          className="w-full px-2 py-1 text-sm border border-gray-200 rounded-lg focus:outline-none bg-white"
                          style={{borderColor: '#E8E8E8'}}
                          onFocus={(e) => e.currentTarget.style.borderColor = '#1D9BF0'}
                          onBlur={(e) => e.currentTarget.style.borderColor = '#E8E8E8'}
                        />
                      </div>
                      <button
                        onClick={spinGacha}
                        disabled={isSpinning}
                        className="px-3 py-1 rounded-lg font-bold transition text-xs text-white"
                        style={{
                          backgroundColor: isSpinning ? '#999' : '#1D9BF0',
                          cursor: isSpinning ? 'not-allowed' : 'pointer'
                        }}
                        onMouseEnter={(e) => {
                          if (!isSpinning) e.currentTarget.style.backgroundColor = '#1A8CD8'
                        }}
                        onMouseLeave={(e) => {
                          if (!isSpinning) e.currentTarget.style.backgroundColor = '#1D9BF0'
                        }}
                      >
                        予算ガチャ
                      </button>
                    </div>
                    
                    {isSpinning && (
                      <div className="mt-2 p-6 bg-blue-50 rounded-lg text-center border-2" style={{borderColor: '#1D9BF0'}}>
                        <div className="text-2xl font-bold animate-pulse" style={{color: '#1D9BF0'}}>
                          抽選中...
                        </div>
                      </div>
                    )}
                    
                    {gachaResult && !isSpinning && (
                      <div className="mt-2 p-6 bg-blue-50 rounded-lg text-center border-2" style={{borderColor: '#1D9BF0'}}>
                        <div className="text-sm font-bold mb-2" style={{color: '#1D9BF0'}}>
                          当選
                        </div>
                        <div className="text-4xl font-bold mb-2" style={{color: '#1D9BF0'}}>
                          ¥{gachaResult.toLocaleString()}
                        </div>
                        <div className="text-xs text-gray-700">予算に追加されました</div>
                      </div>
                    )}
                    
                    <div className="text-xs text-gray-500 mt-1">{today}</div>
                  </div>

                  <div className={`border-b-4 border-gray-100 p-2 ${isOverBudget ? 'bg-red-50' : ''}`} style={!isOverBudget ? {backgroundColor: '#E8F5FD'} : {}}>
                    <div className="flex gap-2">
                      <div className={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${isOverBudget ? 'bg-red-500' : ''}`} style={!isOverBudget ? {backgroundColor: '#1D9BF0'} : {}}>
                        {isOverBudget ? <TrendingDown size={18} className="text-white" /> : <DollarSign size={18} className="text-white" />}
                      </div>
                      <div className="flex-1">
                        <div className="font-bold text-gray-900 mb-1 text-xs">今日の収支</div>
                        <div className="mb-1">
                          <span className="text-gray-600 text-xs">支出：</span>
                          <span className="font-bold text-sm ml-1 text-gray-900">¥{totalExpenses.toLocaleString()}</span>
                        </div>
                        <div>
                          <span className="text-gray-600 text-xs">残高：</span>
                          <span className={`font-bold text-base ml-1 ${isOverBudget ? 'text-red-600' : ''}`} style={!isOverBudget ? {color: '#1D9BF0'} : {}}>
                            {isOverBudget && '-'}¥{Math.abs(remaining).toLocaleString()}
                          </span>
                        </div>
                        {isOverBudget && (
                          <div className="mt-1 text-red-600 font-medium text-xs">
                            予算をオーバーしています
                          </div>
                        )}
                      </div>
                    </div>
                  </div>

                  <div className="bg-gray-50">
                    {expenses.length === 0 ? (
                      <div className="text-center py-8 text-gray-400 bg-white">
                        <div className="mb-2">
                          <DollarSign size={32} className="mx-auto text-gray-300" />
                        </div>
                        <p className="text-xs">まだ支出がありません</p>
                      </div>
                    ) : (
                      <div>
                        {expenses.sort((a, b) => b.id - a.id).map((expense) => {
                          const category = categories.find(c => c.name === expense.category);
                          const Icon = category ? category.icon : DollarSign;
                          const color = category ? category.color : '#1D9BF0';
                          
                          return (
                            <div key={expense.id} className="border-b border-gray-100 p-2 bg-white hover:bg-gray-50 transition">
                              <div className="flex gap-2">
                                <div className="w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0" style={{backgroundColor: `${color}15`}}>
                                  <Icon size={16} style={{color: color}} />
                                </div>
                                <div className="flex-1">
                                  <div className="flex items-start justify-between mb-1">
                                    <div>
                                      <span className="font-bold text-gray-900 text-xs">{expense.category}</span>
                                      <span className="text-gray-400 text-xs ml-1">{expense.date}</span>
                                    </div>
                                    <button
                                      onClick={() => deleteExpense(expense.id)}
                                      className="text-gray-300 hover:text-red-500 transition"
                                    >
                                      <Trash2 size={14} />
                                    </button>
                                  </div>
                                  <div className="text-sm font-bold text-gray-900">
                                    ¥{expense.amount.toLocaleString()}
                                  </div>
                                </div>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    )}
                  </div>
                </>
              ) : (
                <>
                  <div className="p-4 bg-gray-50">
                    <div className="flex items-center justify-between mb-4">
                      <button onClick={() => changeMonth(-1)} className="p-2 hover:bg-gray-100 rounded-full">
                        <ChevronLeft size={24} className="text-gray-700" />
                      </button>
                      <div className="text-xl font-bold text-gray-900">
                        {currentDate.getFullYear()}年 {currentDate.getMonth() + 1}月
                      </div>
                      <button onClick={() => changeMonth(1)} className="p-2 hover:bg-gray-100 rounded-full">
                        <ChevronRight size={24} className="text-gray-700" />
                      </button>
                    </div>
                    {renderCalendar()}
                  </div>
                </>
              )}

              <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-100">
                <div className="max-w-xl mx-auto flex justify-around py-2">
                  <button 
                    onClick={() => setCurrentView('home')}
                    className={`flex flex-col items-center ${currentView === 'home' ? '' : 'text-gray-400'}`}
                    style={currentView === 'home' ? {color: '#1D9BF0'} : {}}
                  >
                    <Home size={20} />
                    <span className="text-xs mt-1">ホーム</span>
                  </button>
                  <button 
                    onClick={() => setCurrentView('calendar')}
                    className={`flex flex-col items-center ${currentView === 'calendar' ? '' : 'text-gray-400'}`}
                    style={currentView === 'calendar' ? {color: '#1D9BF0'} : {}}
                  >
                    <Calendar size={20} />
                    <span className="text-xs mt-1">履歴</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      };

      ReactDOM.render(<BudgetApp />, document.getElementById('root'));
    </script>
  </body>
